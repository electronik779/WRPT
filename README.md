# WRPT - Программа водноэнергетических расчетов многолетнего регулирования для студентов
**Оригинальный алгоритм разработан проф. д.т.н. Г.И. Кривченко и проф. д.т.н. О.А. Муравьевым, НИУ МГСУ (бывший МИСИ)**

Последний раз алгоритм опубликован в:

_Водно-энергетические и водохозяйственные расчеты с использованием ЭВМ (Многолетнее регулирование стока) : методические указания к курсовому и дипломному проектированию для студентов специальности 29.04 «Гидротехническое строительство» / составители Г.И.Кривченко, О.А.Муравьев. — Москва : Московский ордена трудового красного знамени инженерно-строительный университет им. В.В.Куйбышева, 1991. — 30 c._

>[!NOTE]
>Я написал только интерфейс. Алгоритм расчета - оригинальный, с минимальными изменениями - "спагети" код Fortran 77 "распутан" для лучшей читаемости.

----
Программа предназначена для выработки у студентов навыка построения противоперебойной линии диспетчерского графика при многолетнем регулировании стока.
Программа обеспечивает выполнение расчетов на основе решения уравнения водного баланса для многолетнего регулирования. Цикл сработки и наполнения сезонной составляющей объема водохранилища равен одному году. 

Программа WRPT осуществляет расчеты для заданного диспетчерского графика. Поскольку оптимальный вид диспетчерского графика для данных условий заранее неизвестен, то расчеты приходится повторять по нескольку раз: для предварительно принимаемого диспетчерского графика и после его коррекции. Последовательная коррекция диспетчерского графика для каждого календарного месяца требует выполнения нескольких последовательных расчетов.

----

# Установка

## Для Windows

Установка не требуется. Для Windows x64 скачайте файл WRST.exe из раздела Releases (WRPT для Windows x64) в любую удобную для вас папку и запустите.
<!-- Вставить ссылку на скобки -->
## Для остальных ОС

Вы можете самостоятельно клонировать репозиторий и создать исполняемый файл.

----

# Описание интерфейса ввода
Окно ввода исходных данных содержит три управляющие кнопки и семь вкладок.

## Кнопки
![image](https://github.com/user-attachments/assets/352a83bf-d771-4548-b32d-87278daa6ece) - Сохранить исходные данные.

![image](https://github.com/user-attachments/assets/c9b616f5-1f21-46b2-bdd5-4fca7b6118bf) - Загрузить исходные данные.

![image](https://github.com/user-attachments/assets/b85b93a9-2972-4e26-b51d-4b4e07ccda0f) - Выполнить расчет.

>[!NOTE]
>Исходные данные сохраняются в формате CSV, разделитель - точка с запятой.

## Вкладка "Общие данные"


**`Календарный месяц, с которого начинается расчетный ряд`** - Порядковый номер месяца, с которого начинается расчет.

**`Схема питания ГЭС`** - Индивидуальная или групповая схема питания ГЭС.

Индивидуальная схема питания применяется с русловыми и приплотинными ГЭС, когда вода к турбине подводится индивидуальными водоводами.\
Групповая - с деривационными, когда вода к турбине подводится водоводами с развилкой.\
От схемы питания зависит способ учета потерь напора.

**`Полезный объем водохранилища, млн.м³`** - Полезный объем водохранилища в млн.м³.

**`Мертвый объем водохранилища, млн.м³`** - Мертвый объем водохранилища в млн.м³.

**`Объем, выделенный для многолетнего регулирования, млн.м³`** - Часть полезного объема, используемая для многолетнего регулирования, в млн.м³.

**`Начальное заполнение полезного объема, млн.м³`** - Начальное заполнение полезного объема в млн.м³.

**`Полный (максимальный) расход ГЭС, м³/с`** - Максимальный расход турбин ГЭС.

**`Потери напора, м`** - Потери напора в водоводах при расчетном расходе в м.

**`Коэффициент потерь при Qгэс²`** - Коэффициент потерь $k$ при $Q^2$.
>[!NOTE]
>$H_W=kQ^2$

>[!IMPORTANT]
>`Потери напора, м` - отображается при выборе индивидуальной схемы питания;\
>`Коэффициент потерь при Qгэс²` - отображается при выборе групповой схемы питания.

**`Кпд агрегата`** - Средневзвешенный кпд агрегата.

**`Номер контрольного месяца`** - Номер контрольного месяца, по которому печатаются значения мощности в отдельной таблице (обычно 12-ый месяц).

## Вкладка "Приток"


**На вкладке вводятся значения среднемесячного бытового стока (притока).**

Для ввода значений необходимо создать таблицу.\
Введите в поле **`Количество значений среднемесячного притока`** количество значений стока и нажмите кнопку `Создать таблицу`. Будет создана таблица, в которую необходимо ввести значения бытового стока.

>[!IMPORTANT]
>Необходимо вводить значения стока начиная с месяца, указанного в поле **`Календарный месяц, с которого начинается расчетный ряд`** на вкладке **Общие данные**.
>Длина ряда данных должна быть кратна 12 месяцам (т.е. количество данных может быть 12, 24, 36 и т.д.). 

## Вкладка "Параметры вдхр."


**На вкладке вводятся значения батиграфической кривой водохранилища.**

Для ввода значений необходимо создать таблицу.\
Введите в поле **`Количество узловых точек кривой объемов водохранилища`** количество точек апроксимации кривой и нажмите кнопку `Создать таблицу`. Будет создана таблица, в которую необходимо ввести значения объемов в зависимости от отметки в водохранилище.

>[!TIP]
>- Рекомендуется задавать не менее пяти точек аппроксимации.
>- Значения объемов необходимо вводить в возрастающем порядке.
>- Т.к. кривая аппроксимируется линейной интерполяцией, то на криволинейных участках нужно выбирать больше точек.
>- Зависимость нужно начинать от дна водохранилища.

## Вкладка "Параметры НБ"


**На вкладке вводятся значения отметок нижнего бьефа в зависимости от расхода, поступающего в него.**

Для ввода значений необходимо создать таблицу.\
Введите в поле **`Количество узловых точек кривой отметок нижнего бьефа`** количество точек апроксимации кривой и нажмите кнопку `Создать таблицу`. Будет создана таблица, в которую необходимо ввести значения отметок нижнего бьефа в зависимости от от расхода, поступающего в него.

>[!TIP]
>- Рекомендуется задавать не менее пяти точек аппроксимации.
>- Значения расходов необходимо вводить в возрастающем порядке.
>- Т.к. кривая аппроксимируется линейной интерполяцией, то на криволинейных участках нужно выбирать больше точек.

## Вкладка "Диспетчерские остатки"


**На вкладке вводятся значения диспетчерских остатков на конец каждого месяца.**

>[!NOTE]
>Реализуется цикличное регулирование в течении года.

>[!TIP]
> К началу паводка сезонная составляющая объема должна быть сработана.

## Вкладка "Отбор из вдхр."


**На вкладке вводятся значения среднемесячных отборов из водохранилища** на водоснабжение, орошение и т.п.

>[!NOTE]
>При отсутствии данных можно задать равными нулю.

>[!TIP]
>В отборы, кроме самих отборов, нужно включать потери на фильтрацию, испарение, льдообразование.

## Вкладка "Гарантированные расходы"


**На вкладке вводятся значения среднемесячных гарантированных расходов.**

В общем случае в течение года можно иметь два значения расхода - в зимние месяцы одно и другое в остальные. Могут быть индивидуальные значения для каждого месяца.

>[!TIP]
>Для начала можно принять одно значение во всех месяцах - гарантированный расход ГЭС.
>Определяется по гарантированной мощности и минимальному напору декабря:
>
>$Q_{гар}=\frac{N_{гар}}{9,81 H_{т}^{дек} \eta_т \eta_г},\quad \mathnormal{м³/с},$
>
>где $N_{гар}$ - гарантированная мощность, кВт; $H_{т}^{дек}$ - минимальный напор декабря, м; $\eta_т$ - кпд турбины; $\eta_г$ - кпд генератора.

----

# Отображение результатов расчета

Результаты расчета выводятся в отдельном окне, которое содержит одну кнопку и три вкладки

## Кнопка
![image](https://github.com/user-attachments/assets/352a83bf-d771-4548-b32d-87278daa6ece) - Сохранить результат расчета.

>[!NOTE]
>Результаты расчета сохраняются в формате CSV, разделитель - точка с запятой.
>Результаты сохраняются в табличном виде.

## Вкладка "Таблицы"


На вкладке располагается четыре таблицы.

В первой таблице приводятся следующие данные:
- Порядковый номер месяца;
- Календарный номер месяца;
- Расход притока;
- Расход ГЭС;
- Расход холостого сброса;
- Отметка верхнего бьефа;
- Отметка нижнего бьефа;
- Напор турбин;
- Мощность ГЭС;
- Величина избыточного объема.

Во второй - обеспеченности:
- Бытового стока;
- Расхода ГЭС;
- Напора ГЭС;
- Среднесуточных мощностей.

В третьей - дефициты по заданным расходам, относительно гарантированных.

В четвертой - значения мощностей контрольного месяца.

>[!NOTE]
>Расходы ГЭС, меньше гарантированного даются на фоне цвета "Коралл".
>Отрицательные расходы ГЭС даются на фоне цвета "Красный".

## Вкладка "Графики"


На вкладке приведены две группы графиков, построенные по данным вкладки "Таблицы":

- Графики изменения во времени:
  - График 1:
    - Расход притока;
    - Расход ГЭС;
    - Расход холостого сброса;
  - График 2: 
    - Отметка верхнего бьефа;
  - График 3: 
    - Отметка нижнего бьефа;
  - График 4:  
    - Напор турбин;
  - График 5:
    - Мощность ГЭС.
      
- Графики обеспеченности параметров:
  - График 1 - обеспеченность притока к ГЭС;
  - График 2 - обеспеченность расходов ГЭС;
  - График 3 - обеспеченность напоров ГЭС;
  - График 4 - обеспеченность мощностей ГЭС.

## Вкладка "Диспетчерские графики"


На вкладке даны таблица и график.

На них приведены значения остаточных объемов заданных пользователем и полученных расчетом.

----

# Пример


Имеем следующие данные:
- по бытовому стоку (притоку), м³/с:

|Год \ Месяц| 1 | 2 | 3 | 4 |  5 |  6 | 7 | 8 | 9 | 10| 11| 12|
|-----------|---|---|---|---|----|----|---|---|---|---|---|---|
|     1     | 76| 94|162|210|1300|1018|715|672|310|211|182| 76|
|     2     |131|200|391|452|2520|3074|879|815|416|322|275|314|
|     3     | 92|151|230|370|1920|2730|804|725|513|290|240|127|

- полезный объем водохранилища 3 500 млн.м³;
- гарантированный расход 320 м³/с;
- максимальный расход 900 м³/с.

>[!NOTE]
>Файл с данными примера находится в 

Средний многолетний расход равен ~640 м³/с. Значит паводок длится с 5-ого по 8-ой месяцы.

В 8-ом месяце водохранилище точно будет заполнено, значит **`Календарный месяц, с которого начинается расчетный ряд`** принимаем 9-ый месяц.

В период паводка водохранилище будет полным - диспетчерские остатки равны полезному объему, т.е. принимаем диспетчерские остатки с 5-го по 8-ой месяц равными 3 500.

К началу паводка водохранилище должно быть пустым, т.е. диспетчерские остатки д.б. равными нулю, следовательно принимаем на конец 4-го месяца диспетчерский остаток 0.

С 8-го по 4-ый месяц $\pm$ линейно уменьшаем диспетчерские остатки, с 4-го по 6-ой - увеличиваем. В итоге получив следующие значения, млн.м³:

|   Месяц    |  1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |  9 | 10 | 11 | 12 |
|------------|----|---|---|---|----|----|----|----|----|----|----|----|
|Дисп.остаток|1312|875|437| 0 |1700|3500|3500|3500|3062|2625|2187|1750|

## Шаг 1

Наполняем программу данными и выполняем расчет.



Последовательно проверяем все месяцы начиная с 9-го (**`Календарный месяц, с которого начинается расчетный ряд`**). В месяцах 9 (№ п.п. 1, 13, 25) расход больше или равен гарантированному 320 м³/с. **Коррекция противоперебойной линии** - стараемся пропускать только гарантированный расход:

Ищем минимальный бытовой сток в 9-ом месяце - 1-ый по порядку месяц (310 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-310=10$ м³/с. За месяц это составит $10\cdot2,63\cdot10^6=26,3$ млн.м³. Из остаточного объема на конец предыдущего месяца (3 500 млн.м³) вычитаем дополнительный сток 26,3 млн.м³ и получаем в 9-ом месяце остаток $3500-26,3=3 473,7$ млн.м³:

|   Месяц    |  1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 | 11 | 12 |
|------------|----|---|---|---|----|----|----|----|------|----|----|----|
|Дисп.остаток|1312|875|437| 0 |1700|3500|3500|3500|3473,7|2625|2187|1750|

## Шаг 2

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 10 (№ п.п. 2, 14, 26) расход больше или равен гарантированному. Стараемся пропускать только гарантированный расход. Ищем минимальный бытовой сток в 10-ом месяце - 2-ой по порядку месяц (211 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-211=109$ м³/с. За месяц это составит $109\cdot2,63\cdot10^6=286,67\approx286,7$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 10-ом месяце остаток $3 473,7-286,7=3 187$ млн.м³:

|   Месяц    |  1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 | 11 | 12 |
|------------|----|---|---|---|----|----|----|----|------|----|----|----|
|Дисп.остаток|1312|875|437| 0 |1700|3500|3500|3500|3473,7|3187|2187|1750|

## Шаг 3

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 11 (№ п.п. 3, 15, 27) расход больше или равен гарантированному. Ищем минимальный бытовой сток в 11-ом месяце - 3-ий по порядку месяц (182 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-182=138$ м³/с. За месяц это составит $138\cdot2,63\cdot10^6=362,94\approx362,9$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 11-ом месяце остаток $3 187-362,9=2 824,1$ млн.м³:

|   Месяц    |  1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  | 12 |
|------------|----|---|---|---|----|----|----|----|------|----|------|----|
|Дисп.остаток|1312|875|437| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|1750|

## Шаг 4

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 12 (№ п.п. 4, 16, 28) расход больше или равен гарантированному. Ищем минимальный бытовой сток в 12-ом месяце - 4-ый по порядку месяц (76 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-76=244$ м³/с. За месяц это составит $244\cdot2,63\cdot10^6=641,72\approx641,7$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 12-ом месяце остаток $2 824,1-641,7=2 182,4$ млн.м³:

|   Месяц    |  1 | 2 | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
|------------|----|---|---|---|----|----|----|----|------|----|------|------|
|Дисп.остаток|1312|875|437| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|2182,4|

## Шаг 5

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 1 (№ п.п. 5, 17, 29) расход больше или равен гарантированному. Ищем минимальный бытовой сток в 1-ом месяце - 29-ый по порядку месяц (76 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-76=244$ м³/с. За месяц это составит $244\cdot2,63\cdot10^6=641,72\approx641,7$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 1-ом месяце остаток $2 182,4-641,7=1 540,7$ млн.м³:

|   Месяц    |   1  | 2 | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
|------------|------|---|---|---|----|----|----|----|------|----|------|------|
|Дисп.остаток|1540,7|875|437| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|2182,4|

## Шаг 6

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 2 (№ п.п. 6, 18, 30) расход больше или равен гарантированному. Ищем минимальный бытовой сток во 2-ом месяце - 30-ый по порядку месяц (94 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-94=226$ м³/с. За месяц это составит $226\cdot2,63\cdot10^6=594,38\approx594,4$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем во 2-ом месяце остаток $1 540,7-594,4=946,3$ млн.м³:

|   Месяц    |   1  |  2  | 3 | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
|------------|------|-----|---|---|----|----|----|----|------|----|------|------|
|Дисп.остаток|1540,7|946,3|437| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|2182,4|

## Шаг 7

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 3 (№ п.п. 7, 19, 31) расход больше или равен гарантированному. Ищем минимальный бытовой сток в 3-ом месяце - 31-ый по порядку месяц (162 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-162=158$ м³/с. За месяц это составит $158\cdot2,63\cdot10^6=415,54\approx415,5$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 3-ем месяце остаток $946,3-415,5=530,8$ млн.м³:

|   Месяц    |   1  |  2  |  3  | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
|------------|------|-----|-----|---|----|----|----|----|------|----|------|------|
|Дисп.остаток|1540,7|946,3|530,8| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|2182,4|

## Шаг 8

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 4 (№ п.п. 8, 20, 32) расход больше гарантированного. Ищем минимальный бытовой сток в 4-ом месяце - 32-ой по порядку месяц (210 м³/с). Находим какой расход, свыше бытового нужно пропустить, что-бы обеспечить гарантированный расход: $320-210=110$ м³/с. За месяц это составит $110\cdot2,63\cdot10^6=289,3$ млн.м³. Из остаточного объема на конец предыдущего месяца вычитаем дополнительный сток и получаем в 4-ом месяце остаток $530,8-289,3=241,5$ млн.м³.

К концу 4-го месяца водохранилище должно быть пустым (на отметке УМО), а у нас осталось не использованными 241,5 млн.м³ это потеря выработки. Необходимо использовать этот объем в предыдущие месяцы. Например в 3-ий месяц - остаток в 3-ем месяце 530,8 млн.м³ и надо забрать еще 241,5 млн.м³. Получаем остаток в 3-ем месяце $530,8-241,5=289,3$ млн.м³.

|   Месяц    |   1  |  2  |  3  | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
|------------|------|-----|-----|---|----|----|----|----|------|----|------|------|
|Дисп.остаток|1540,7|946,3|289,3| 0 |1700|3500|3500|3500|3473,7|3187|2824,1|2182,4|

>[!TIP]
>По режиму работы ГЭС лучше перенести лишний объем на паводковые месяцы или на конец паводка.

## Шаг 9 и 10

Корректируем значение диспетчерского остатка в программе и выполняем расчет.



В месяцах 5 (№ п.п. 9, 21, 33) и 6 (№ п.п. 10, 22, 34) идет наполнение водохранилища. Коррекция противоперебойной линии не требуется.

>[!CAUTION]
>Обратите внимание: если бы я захотел наполнить водохранилище за один 5-ый месяц:
>
>|   Месяц    |   1  |  2  |  3  | 4 |  5 |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
>|------------|------|-----|-----|---|----|----|----|----|------|----|------|------|
>|Дисп.остаток|1540,7|946,3|289,3| 0 |3500|3500|3500|3500|3473,7|3187|2824,1|2182,4|
>
>
>Мне не хватило бы воды и пришлось бы делать коррекцию:
>
>В месяце 5 (№ п.п. 33) расход ГЭС отрицательный (минус 30,8 м³/с) это значит, что не хватает воды наполнить водохранилище до объема 3500 млн.м³. Определяем недостающий объем $(320+30,8)\cdot2,63\cdot10^6=922,604\approx922,6$ млн.м³ и вычисляем остаточный объем в 5-ом месяце $3500-922,6=2577,4$ млн.м³.
>
>|   Месяц    |   1  |  2  |  3  | 4 |   5  |  6 |  7 |  8 |   9  | 10 |  11  |  12  |
>|------------|------|-----|-----|---|------|----|----|----|------|----|------|------|
>|Дисп.остаток|1540,7|946,3|289,3| 0 |2577,4|3500|3500|3500|3473,7|3187|2824,1|2182,4|
>
>Корректируем значение диспетчерского остатка в программе и выполняем расчет.
>


## Шаг 11 и 12

В месяцах 7 (№ п.п. 11, 23, 35) и 8 (№ п.п. 12, 24, 36) водохранилище полностью заполнено, идет максимальный пропуск воды. Коррекция противоперебойной линии не требуется.



**На этом коррекция противоперебойной линии закончена.**

Обратите внимание как в процессе коррекции изменяется значение среднегодовой выработки и холостых сбросов.

>[!NOTE]
>Следующим этапом должна быть оптимизация противоперебойной линии для уменьшения объемов холостых сбросов (в идеале их полное отсутствие).
